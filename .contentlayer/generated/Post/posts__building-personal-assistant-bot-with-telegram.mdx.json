{
  "title": "Building personal assistant bot with telegram",
  "date": "2022-09-29T00:00:00.000Z",
  "body": {
    "raw": "\n<figure>\n  <img\n    src=\"https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/06f15b9b-f930-4389-98d6-9a1350406344/d3csubx-ef400f4d-f1d5-4ad0-ad79-397f2a0d9d7a.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7InBhdGgiOiJcL2ZcLzA2ZjE1YjliLWY5MzAtNDM4OS05OGQ2LTlhMTM1MDQwNjM0NFwvZDNjc3VieC1lZjQwMGY0ZC1mMWQ1LTRhZDAtYWQ3OS0zOTdmMmEwZDlkN2EuanBnIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmZpbGUuZG93bmxvYWQiXX0.dhXt5qZ_EDROz5mHocVMiecOxis-ZeIYPzghstUSml0\"\n    alt=\"Bot Arm\"\n  />\n  <figcaption>\n    [source](https://www.deviantart.com/eskimomittens/art/Diesel-Punk-Arm-202899597)\n  </figcaption>\n</figure>\n\nIn this post I’ll document what I’ve done to build [a telegram bot](https://core.telegram.org/bots/api) that helps me track most of useful things i know, do, willing to share with public.\n\n## Motivation\n\nI’ve created a wiki to share my bookmarks, links, articles, tools, …etc, but **the problem was** when you find good link or anything and want to add it to the wiki, in this situation I was open [Gitbook](https://www.gitbook.com/) dashboard, and searching for the document that i want to add to, then push and sync. That was taking a lot of time, and i had have to do this from my laptop super boring, isn’t it?\n\nThe problem appears strongly when reading a book and add comments or notes, and want to track it or share it, similar thing to my IMDB reviews. All of this was annoying me to add to it, so I decided to build a bot that can collect these things and add them whenever I tell him to do so.\n\n## Features\n\nOkay, now I’ve a problem with an idea to solve it. The first thing i was supposed to do is listing the main commands for this bot to understand.\n\n- `/syncIMDB` List all Movies/TV Series/Video Games ratings from IMDB.\n- `/syncNotion` Publishing pages to [notes.zeyadetman.com](http://notes.zeyadetman.com) from Notion.\n\n## Starting the Bot Implementation\n\nSo while I was thinking about how can i organize the bot object and its behaviors, I ended up with implement the [Decorator design pattern](https://refactoring.guru/design-patterns/decorator).\n\n**Decorator design pattern:** In this pattern you have 4 main things:\n\n1. The main interface for your component and basic methods “without implementation”, in my case it’s the Bot.\n2. The main concrete component that implements the default behavior of component behaviors.\n3. The base decorator that act like a wrapper for concrete decorators.\n4. The concrete decorator is to call the object and alter it.\n\n**Why?** I have a monolithic class (Bot) with a bunch of behaviors and actions, like commands, configurations, messages, …etc, so i want to divide them into smaller classes that each class contains one behavior or action.\n\nI split the main features into multiple concrete decorators.\n\n- One to handle the [`BotCommands`](https://core.telegram.org/api/bots/commands) , every command starting with `/`\n\n```tsx\nexport class BotWithCommands extends DecoratorBot {\n  private setCommands(bot) {\n    bot.command(\"syncIMDB\", syncIMDB);\n    bot.start(start);\n    bot.help(help);\n  }\n\n  public launch() {\n    this.setCommands(this.bot);\n    super.launch();\n  }\n}\n```\n\n- One to handle `BotEvents` or [inline queries](https://core.telegram.org/api/bots/inline).\n\n```tsx\nimport { DecoratorBot } from \"../decorator\";\nimport { documentEvent } from \"./document\";\n\nexport class BotWithEvents extends DecoratorBot {\n  private setEvents(bot) {\n    bot.on(\"document\", documentEvent);\n    bot.on(\"sticker\", (ctx: any) => ctx.reply(\"👍\"));\n  }\n\n  public launch() {\n    this.setEvents(this.bot);\n    super.launch();\n  }\n}\n```\n\nYou can [read the code](https://github.com/zeyadetman/ben-personal-assistant) to understand more about the implementation and the idea for these decorators.\n\nThe final structure was something like this\n\n```bash\n.\n├── commands\n│   ├── help.ts\n│   ├── index.ts\n│   ├── start.ts\n│   ├── syncIMDB.ts\n│   └── syncNotion.ts\n├── decorator\n│   └── index.ts\n├── events\n│   ├── document.ts\n│   └── index.ts\n├── index.ts\n├── types\n└── utils\n    ├── constants.ts\n    ├── convert-name.ts\n    └── writeFileToGithub.ts\n```\n\n### `/syncIMDB` Create a list of my movies ratings\n\nThis was the first thing i handled in the bot. The problem is I need to show a list of all my movies ratings, I use IMDB to track this, but IMDB doesn’t offer apis to get my ratings, So the solution that i use is exporting the ratings manually, and send this file to the bot telling him to update this file to [re-format it](https://github.com/zeyadetman/ben-personal-assistant/blob/7528d28b6b860c819eadf321d616c3986dd0e4c4/src/commands/syncIMDB.ts#L14) into [a json file](https://github.com/zeyadetman/Notes/blob/main/src/data/imdb.json), then add this file to the notes app, and GitHub action will redeploy the app updating the movies list on my notes app with these new ratings.\n\nI use [nivo.rocks](https://nivo.rocks/) to visualize the genres and make the list more interactive. Please [read my comment](https://github.com/plouc/nivo/issues/920#issuecomment-1256857723) on how I implemented it.\n\nThis was a little bit tricky especially because I’m using [docusaurus.io](https://docusaurus.io/) but you can check the code for it [from here](https://github.com/zeyadetman/Notes/edit/main/docs/watch-list/movies.mdx).\n\nI use the same json file to add more pages with the same style.\n\n- [https://notes.zeyadetman.com/watch-list/](https://notes.zeyadetman.com/watch-list/)\n- [https://notes.zeyadetman.com/games/](https://notes.zeyadetman.com/games/)\n\n## `/syncNotion` Notion integration\n\nThe second thing is getting pages from notion. So the idea is creating a [database on notion](https://www.notion.so/help/intro-to-databases) that contains multiple nested pages with their slugs/paths and this command will get the database by its id and fetching all pages under this databases including nested databases, then create commits with the files on [Notes Repo on GitHub](https://github.com/zeyadetman/Notes/). That’s the idea I’ve came with.\n\nHere’s the code for it.\n\n```tsx\nconst handleDatabases = async (\n  databaseId: string,\n  pagesToPublish: any,\n  parentSlug = \"\"\n) => {\n  return new Promise(async (resolve, reject) => {\n    try {\n      const { results } = await notion.databases.query({\n        database_id: databaseId,\n      });\n      const pages = results.filter((res) => res.object === \"page\");\n      pages.forEach(async (page: any) => {\n        if (page?.properties?.Slug?.rich_text?.[0]?.plain_text) {\n          pagesToPublish[page.properties.Slug.rich_text[0].plain_text] = {\n            slug: page.properties.Slug.rich_text[0].plain_text,\n            isPublish: page.properties?.Published?.checkbox || false,\n            path: `${parentSlug || \"\"}${\n              page.properties.Slug.rich_text[0].plain_text\n            }`,\n            page,\n          };\n        } else {\n          return ctx.reply(\"Please add a slug to the page\");\n        }\n      });\n\n      for await (let page of Object.values(pagesToPublish)) {\n        const { slug, page: pageInfo } = page as any;\n        const mdblocks = await n2m.pageToMarkdown(pageInfo.id);\n        const finalMdBlocks = [];\n        mdblocks?.forEach(async (block: any, index) => {\n          if (index === mdblocks?.length - 1) {\n            return;\n          }\n          if (block.type === \"child_database\") {\n            const databaseId = block.parent.split(\"(\").pop().split(\")\")[0];\n            pagesToPublish[slug].children = {\n              databaseId,\n              slug,\n              parentSlug: `${parentSlug || \"\"}${slug}`,\n            };\n          } else {\n            finalMdBlocks.push(block);\n          }\n        });\n\n        pagesToPublish[slug].mdBlocks = finalMdBlocks;\n      }\n\n      for await (let page of Object.keys(pagesToPublish)) {\n        const { children, slug } = pagesToPublish[page] as any;\n        if (children?.databaseId) {\n          pagesToPublish[slug].childs = await handleDatabases(\n            children.databaseId,\n            {},\n            `${children.parentSlug}`\n          );\n        }\n      }\n\n      console.log(util.inspect(pagesToPublish, false, null, true));\n      return resolve(pagesToPublish);\n    } catch (error) {\n      return reject(error.message);\n    }\n  });\n};\n```\n\nAnd that’s works great with a sample of notion database like this:\n![](/assets/telegram-bot-img1.PNG)\n\nSo if the page’s `Published` property is false, then the page will not be published to github repo, and if the page doesn’t have a `Slug` property it should gives an error, because the slug is a path of that file.\n\nThe final command on telegram gave me this reply\n![](/assets/telegram-bot-img2.PNG)\n\nWow! that’s totally awesome 😎\n\n<br />\nUntil then I’ll let this post ends in this point and will update it whenever I add\nnew feature.\n\n…to be continued\n\n<br />\n<br />\n\n_Updated at { new Date(\"2021-09-28\").toDateString() }_\n",
    "code": "var Component=(()=>{var ln=Object.create;var I=Object.defineProperty;var cn=Object.getOwnPropertyDescriptor;var un=Object.getOwnPropertyNames;var mn=Object.getPrototypeOf,fn=Object.prototype.hasOwnProperty;var G=(c,n)=>()=>(n||c((n={exports:{}}).exports,n),n.exports),bn=(c,n)=>{for(var p in n)I(c,p,{get:n[p],enumerable:!0})},Ne=(c,n,p,v)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let y of un(n))!fn.call(c,y)&&y!==p&&I(c,y,{get:()=>n[y],enumerable:!(v=cn(n,y))||v.enumerable});return c};var hn=(c,n,p)=>(p=c!=null?ln(mn(c)):{},Ne(n||!c||!c.__esModule?I(p,\"default\",{value:c,enumerable:!0}):p,c)),pn=c=>Ne(I({},\"__esModule\",{value:!0}),c);var Pe=G((xn,xe)=>{xe.exports=React});var Se=G(Z=>{\"use strict\";(function(){\"use strict\";var c=Pe(),n=Symbol.for(\"react.element\"),p=Symbol.for(\"react.portal\"),v=Symbol.for(\"react.fragment\"),y=Symbol.for(\"react.strict_mode\"),X=Symbol.for(\"react.profiler\"),Q=Symbol.for(\"react.provider\"),J=Symbol.for(\"react.context\"),z=Symbol.for(\"react.forward_ref\"),C=Symbol.for(\"react.suspense\"),D=Symbol.for(\"react.suspense_list\"),E=Symbol.for(\"react.memo\"),M=Symbol.for(\"react.lazy\"),Ee=Symbol.for(\"react.offscreen\"),q=Symbol.iterator,Ue=\"@@iterator\";function Te(e){if(e===null||typeof e!=\"object\")return null;var r=q&&e[q]||e[Ue];return typeof r==\"function\"?r:null}var x=c.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function f(e){{for(var r=arguments.length,a=new Array(r>1?r-1:0),d=1;d<r;d++)a[d-1]=arguments[d];Re(\"error\",e,a)}}function Re(e,r,a){{var d=x.ReactDebugCurrentFrame,s=d.getStackAddendum();s!==\"\"&&(r+=\"%s\",a=a.concat([s]));var l=a.map(function(o){return String(o)});l.unshift(\"Warning: \"+r),Function.prototype.apply.call(console[e],console,l)}}var ke=!1,Oe=!1,Ie=!1,Ce=!1,De=!1,H;H=Symbol.for(\"react.module.reference\");function Me(e){return!!(typeof e==\"string\"||typeof e==\"function\"||e===v||e===X||De||e===y||e===C||e===D||Ce||e===Ee||ke||Oe||Ie||typeof e==\"object\"&&e!==null&&(e.$$typeof===M||e.$$typeof===E||e.$$typeof===Q||e.$$typeof===J||e.$$typeof===z||e.$$typeof===H||e.getModuleId!==void 0))}function Ae(e,r,a){var d=e.displayName;if(d)return d;var s=r.displayName||r.name||\"\";return s!==\"\"?a+\"(\"+s+\")\":a}function K(e){return e.displayName||\"Context\"}function _(e){if(e==null)return null;if(typeof e.tag==\"number\"&&f(\"Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue.\"),typeof e==\"function\")return e.displayName||e.name||null;if(typeof e==\"string\")return e;switch(e){case v:return\"Fragment\";case p:return\"Portal\";case X:return\"Profiler\";case y:return\"StrictMode\";case C:return\"Suspense\";case D:return\"SuspenseList\"}if(typeof e==\"object\")switch(e.$$typeof){case J:var r=e;return K(r)+\".Consumer\";case Q:var a=e;return K(a._context)+\".Provider\";case z:return Ae(e,e.render,\"ForwardRef\");case E:var d=e.displayName||null;return d!==null?d:_(e.type)||\"Memo\";case M:{var s=e,l=s._payload,o=s._init;try{return _(o(l))}catch{return null}}}return null}var N=Object.assign,j=0,ee,ne,te,re,ae,de,ie;function oe(){}oe.__reactDisabledLog=!0;function Fe(){{if(j===0){ee=console.log,ne=console.info,te=console.warn,re=console.error,ae=console.group,de=console.groupCollapsed,ie=console.groupEnd;var e={configurable:!0,enumerable:!0,value:oe,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}j++}}function Be(){{if(j--,j===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:N({},e,{value:ee}),info:N({},e,{value:ne}),warn:N({},e,{value:te}),error:N({},e,{value:re}),group:N({},e,{value:ae}),groupCollapsed:N({},e,{value:de}),groupEnd:N({},e,{value:ie})})}j<0&&f(\"disabledDepth fell below zero. This is a bug in React. Please file an issue.\")}}var A=x.ReactCurrentDispatcher,F;function U(e,r,a){{if(F===void 0)try{throw Error()}catch(s){var d=s.stack.trim().match(/\\n( *(at )?)/);F=d&&d[1]||\"\"}return`\n`+F+e}}var B=!1,T;{var Ye=typeof WeakMap==\"function\"?WeakMap:Map;T=new Ye}function se(e,r){if(!e||B)return\"\";{var a=T.get(e);if(a!==void 0)return a}var d;B=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var l;l=A.current,A.current=null,Fe();try{if(r){var o=function(){throw Error()};if(Object.defineProperty(o.prototype,\"props\",{set:function(){throw Error()}}),typeof Reflect==\"object\"&&Reflect.construct){try{Reflect.construct(o,[])}catch(g){d=g}Reflect.construct(e,[],o)}else{try{o.call()}catch(g){d=g}e.call(o.prototype)}}else{try{throw Error()}catch(g){d=g}e()}}catch(g){if(g&&d&&typeof g.stack==\"string\"){for(var i=g.stack.split(`\n`),b=d.stack.split(`\n`),u=i.length-1,m=b.length-1;u>=1&&m>=0&&i[u]!==b[m];)m--;for(;u>=1&&m>=0;u--,m--)if(i[u]!==b[m]){if(u!==1||m!==1)do if(u--,m--,m<0||i[u]!==b[m]){var h=`\n`+i[u].replace(\" at new \",\" at \");return e.displayName&&h.includes(\"<anonymous>\")&&(h=h.replace(\"<anonymous>\",e.displayName)),typeof e==\"function\"&&T.set(e,h),h}while(u>=1&&m>=0);break}}}finally{B=!1,A.current=l,Be(),Error.prepareStackTrace=s}var S=e?e.displayName||e.name:\"\",ve=S?U(S):\"\";return typeof e==\"function\"&&T.set(e,ve),ve}function We(e,r,a){return se(e,!1)}function Ve(e){var r=e.prototype;return!!(r&&r.isReactComponent)}function R(e,r,a){if(e==null)return\"\";if(typeof e==\"function\")return se(e,Ve(e));if(typeof e==\"string\")return U(e);switch(e){case C:return U(\"Suspense\");case D:return U(\"SuspenseList\")}if(typeof e==\"object\")switch(e.$$typeof){case z:return We(e.render);case E:return R(e.type,r,a);case M:{var d=e,s=d._payload,l=d._init;try{return R(l(s),r,a)}catch{}}}return\"\"}var k=Object.prototype.hasOwnProperty,le={},ce=x.ReactDebugCurrentFrame;function O(e){if(e){var r=e._owner,a=R(e.type,e._source,r?r.type:null);ce.setExtraStackFrame(a)}else ce.setExtraStackFrame(null)}function $e(e,r,a,d,s){{var l=Function.call.bind(k);for(var o in e)if(l(e,o)){var i=void 0;try{if(typeof e[o]!=\"function\"){var b=Error((d||\"React class\")+\": \"+a+\" type `\"+o+\"` is invalid; it must be a function, usually from the `prop-types` package, but received `\"+typeof e[o]+\"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.\");throw b.name=\"Invariant Violation\",b}i=e[o](r,o,d,a,null,\"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED\")}catch(u){i=u}i&&!(i instanceof Error)&&(O(s),f(\"%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).\",d||\"React class\",a,o,typeof i),O(null)),i instanceof Error&&!(i.message in le)&&(le[i.message]=!0,O(s),f(\"Failed %s type: %s\",a,i.message),O(null))}}}var Le=Array.isArray;function Y(e){return Le(e)}function Ge(e){{var r=typeof Symbol==\"function\"&&Symbol.toStringTag,a=r&&e[Symbol.toStringTag]||e.constructor.name||\"Object\";return a}}function Ze(e){try{return ue(e),!1}catch{return!0}}function ue(e){return\"\"+e}function me(e){if(Ze(e))return f(\"The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.\",Ge(e)),ue(e)}var w=x.ReactCurrentOwner,Xe={key:!0,ref:!0,__self:!0,__source:!0},fe,be,W;W={};function Qe(e){if(k.call(e,\"ref\")){var r=Object.getOwnPropertyDescriptor(e,\"ref\").get;if(r&&r.isReactWarning)return!1}return e.ref!==void 0}function Je(e){if(k.call(e,\"key\")){var r=Object.getOwnPropertyDescriptor(e,\"key\").get;if(r&&r.isReactWarning)return!1}return e.key!==void 0}function qe(e,r){if(typeof e.ref==\"string\"&&w.current&&r&&w.current.stateNode!==r){var a=_(w.current.type);W[a]||(f('Component \"%s\" contains the string ref \"%s\". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',_(w.current.type),e.ref),W[a]=!0)}}function He(e,r){{var a=function(){fe||(fe=!0,f(\"%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)\",r))};a.isReactWarning=!0,Object.defineProperty(e,\"key\",{get:a,configurable:!0})}}function Ke(e,r){{var a=function(){be||(be=!0,f(\"%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)\",r))};a.isReactWarning=!0,Object.defineProperty(e,\"ref\",{get:a,configurable:!0})}}var en=function(e,r,a,d,s,l,o){var i={$$typeof:n,type:e,key:r,ref:a,props:o,_owner:l};return i._store={},Object.defineProperty(i._store,\"validated\",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(i,\"_self\",{configurable:!1,enumerable:!1,writable:!1,value:d}),Object.defineProperty(i,\"_source\",{configurable:!1,enumerable:!1,writable:!1,value:s}),Object.freeze&&(Object.freeze(i.props),Object.freeze(i)),i};function nn(e,r,a,d,s){{var l,o={},i=null,b=null;a!==void 0&&(me(a),i=\"\"+a),Je(r)&&(me(r.key),i=\"\"+r.key),Qe(r)&&(b=r.ref,qe(r,s));for(l in r)k.call(r,l)&&!Xe.hasOwnProperty(l)&&(o[l]=r[l]);if(e&&e.defaultProps){var u=e.defaultProps;for(l in u)o[l]===void 0&&(o[l]=u[l])}if(i||b){var m=typeof e==\"function\"?e.displayName||e.name||\"Unknown\":e;i&&He(o,m),b&&Ke(o,m)}return en(e,i,b,s,d,w.current,o)}}var V=x.ReactCurrentOwner,he=x.ReactDebugCurrentFrame;function P(e){if(e){var r=e._owner,a=R(e.type,e._source,r?r.type:null);he.setExtraStackFrame(a)}else he.setExtraStackFrame(null)}var $;$=!1;function L(e){return typeof e==\"object\"&&e!==null&&e.$$typeof===n}function pe(){{if(V.current){var e=_(V.current.type);if(e)return`\n\nCheck the render method of \\``+e+\"`.\"}return\"\"}}function tn(e){{if(e!==void 0){var r=e.fileName.replace(/^.*[\\\\\\/]/,\"\"),a=e.lineNumber;return`\n\nCheck your code at `+r+\":\"+a+\".\"}return\"\"}}var _e={};function rn(e){{var r=pe();if(!r){var a=typeof e==\"string\"?e:e.displayName||e.name;a&&(r=`\n\nCheck the top-level render call using <`+a+\">.\")}return r}}function ge(e,r){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var a=rn(r);if(_e[a])return;_e[a]=!0;var d=\"\";e&&e._owner&&e._owner!==V.current&&(d=\" It was passed a child from \"+_(e._owner.type)+\".\"),P(e),f('Each child in a list should have a unique \"key\" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',a,d),P(null)}}function ye(e,r){{if(typeof e!=\"object\")return;if(Y(e))for(var a=0;a<e.length;a++){var d=e[a];L(d)&&ge(d,r)}else if(L(e))e._store&&(e._store.validated=!0);else if(e){var s=Te(e);if(typeof s==\"function\"&&s!==e.entries)for(var l=s.call(e),o;!(o=l.next()).done;)L(o.value)&&ge(o.value,r)}}}function an(e){{var r=e.type;if(r==null||typeof r==\"string\")return;var a;if(typeof r==\"function\")a=r.propTypes;else if(typeof r==\"object\"&&(r.$$typeof===z||r.$$typeof===E))a=r.propTypes;else return;if(a){var d=_(r);$e(a,e.props,\"prop\",d,e)}else if(r.PropTypes!==void 0&&!$){$=!0;var s=_(r);f(\"Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?\",s||\"Unknown\")}typeof r.getDefaultProps==\"function\"&&!r.getDefaultProps.isReactClassApproved&&f(\"getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.\")}}function dn(e){{for(var r=Object.keys(e.props),a=0;a<r.length;a++){var d=r[a];if(d!==\"children\"&&d!==\"key\"){P(e),f(\"Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.\",d),P(null);break}}e.ref!==null&&(P(e),f(\"Invalid attribute `ref` supplied to `React.Fragment`.\"),P(null))}}function on(e,r,a,d,s,l){{var o=Me(e);if(!o){var i=\"\";(e===void 0||typeof e==\"object\"&&e!==null&&Object.keys(e).length===0)&&(i+=\" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.\");var b=tn(s);b?i+=b:i+=pe();var u;e===null?u=\"null\":Y(e)?u=\"array\":e!==void 0&&e.$$typeof===n?(u=\"<\"+(_(e.type)||\"Unknown\")+\" />\",i=\" Did you accidentally export a JSX literal instead of a component?\"):u=typeof e,f(\"React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s\",u,i)}var m=nn(e,r,a,s,l);if(m==null)return m;if(o){var h=r.children;if(h!==void 0)if(d)if(Y(h)){for(var S=0;S<h.length;S++)ye(h[S],e);Object.freeze&&Object.freeze(h)}else f(\"React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.\");else ye(h,e)}return e===v?dn(m):an(m),m}}var sn=on;Z.Fragment=v,Z.jsxDEV=sn})()});var we=G((Sn,je)=>{\"use strict\";je.exports=Se()});var vn={};bn(vn,{default:()=>yn,frontmatter:()=>_n});var t=hn(we()),_n={title:\"Building personal assistant bot with telegram\",date:\"2022-09-29\",author:\"zeyadetman\",tags:[\"notion\",\"telegram-bot\",\"typescript\",\"nodejs\"],comments:!0,layout:\"post\"};function ze(c){let n=Object.assign({p:\"p\",a:\"a\",h2:\"h2\",strong:\"strong\",ul:\"ul\",li:\"li\",code:\"code\",ol:\"ol\",pre:\"pre\",h3:\"h3\",img:\"img\",em:\"em\"},c.components);return(0,t.jsxDEV)(t.Fragment,{children:[(0,t.jsxDEV)(\"figure\",{children:[(0,t.jsxDEV)(\"img\",{src:\"https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/06f15b9b-f930-4389-98d6-9a1350406344/d3csubx-ef400f4d-f1d5-4ad0-ad79-397f2a0d9d7a.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7InBhdGgiOiJcL2ZcLzA2ZjE1YjliLWY5MzAtNDM4OS05OGQ2LTlhMTM1MDQwNjM0NFwvZDNjc3VieC1lZjQwMGY0ZC1mMWQ1LTRhZDAtYWQ3OS0zOTdmMmEwZDlkN2EuanBnIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmZpbGUuZG93bmxvYWQiXX0.dhXt5qZ_EDROz5mHocVMiecOxis-ZeIYPzghstUSml0\",alt:\"Bot Arm\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:15,columnNumber:3},this),(0,t.jsxDEV)(\"figcaption\",{children:(0,t.jsxDEV)(n.p,{children:(0,t.jsxDEV)(n.a,{href:\"https://www.deviantart.com/eskimomittens/art/Diesel-Punk-Arm-202899597\",children:\"source\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:20,columnNumber:5},this)},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:20,columnNumber:5},this)},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:19,columnNumber:3},this)]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:14,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:[\"In this post I\\u2019ll document what I\\u2019ve done to build \",(0,t.jsxDEV)(n.a,{href:\"https://core.telegram.org/bots/api\",children:\"a telegram bot\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:24,columnNumber:52},this),\" that helps me track most of useful things i know, do, willing to share with public.\"]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:24,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.h2,{children:\"Motivation\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:26,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:[\"I\\u2019ve created a wiki to share my bookmarks, links, articles, tools, \\u2026etc, but \",(0,t.jsxDEV)(n.strong,{children:\"the problem was\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:28,columnNumber:78},this),\" when you find good link or anything and want to add it to the wiki, in this situation I was open \",(0,t.jsxDEV)(n.a,{href:\"https://www.gitbook.com/\",children:\"Gitbook\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:28,columnNumber:195},this),\" dashboard, and searching for the document that i want to add to, then push and sync. That was taking a lot of time, and i had have to do this from my laptop super boring, isn\\u2019t it?\"]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:28,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:\"The problem appears strongly when reading a book and add comments or notes, and want to track it or share it, similar thing to my IMDB reviews. All of this was annoying me to add to it, so I decided to build a bot that can collect these things and add them whenever I tell him to do so.\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:30,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.h2,{children:\"Features\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:32,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:\"Okay, now I\\u2019ve a problem with an idea to solve it. The first thing i was supposed to do is listing the main commands for this bot to understand.\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:34,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.ul,{children:[`\n`,(0,t.jsxDEV)(n.li,{children:[(0,t.jsxDEV)(n.code,{children:\"/syncIMDB\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:36,columnNumber:3},this),\" List all Movies/TV Series/Video Games ratings from IMDB.\"]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:36,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.li,{children:[(0,t.jsxDEV)(n.code,{children:\"/syncNotion\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:37,columnNumber:3},this),\" Publishing pages to \",(0,t.jsxDEV)(n.a,{href:\"http://notes.zeyadetman.com\",children:\"notes.zeyadetman.com\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:37,columnNumber:37},this),\" from Notion.\"]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:37,columnNumber:1},this),`\n`]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:36,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.h2,{children:\"Starting the Bot Implementation\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:39,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:[\"So while I was thinking about how can i organize the bot object and its behaviors, I ended up with implement the \",(0,t.jsxDEV)(n.a,{href:\"https://refactoring.guru/design-patterns/decorator\",children:\"Decorator design pattern\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:41,columnNumber:114},this),\".\"]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:41,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:[(0,t.jsxDEV)(n.strong,{children:\"Decorator design pattern:\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:43,columnNumber:1},this),\" In this pattern you have 4 main things:\"]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:43,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.ol,{children:[`\n`,(0,t.jsxDEV)(n.li,{children:\"The main interface for your component and basic methods \\u201Cwithout implementation\\u201D, in my case it\\u2019s the Bot.\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:45,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.li,{children:\"The main concrete component that implements the default behavior of component behaviors.\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:46,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.li,{children:\"The base decorator that act like a wrapper for concrete decorators.\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:47,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.li,{children:\"The concrete decorator is to call the object and alter it.\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:48,columnNumber:1},this),`\n`]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:45,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:[(0,t.jsxDEV)(n.strong,{children:\"Why?\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:50,columnNumber:1},this),\" I have a monolithic class (Bot) with a bunch of behaviors and actions, like commands, configurations, messages, \\u2026etc, so i want to divide them into smaller classes that each class contains one behavior or action.\"]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:50,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:\"I split the main features into multiple concrete decorators.\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:52,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.ul,{children:[`\n`,(0,t.jsxDEV)(n.li,{children:[\"One to handle the \",(0,t.jsxDEV)(n.a,{href:\"https://core.telegram.org/api/bots/commands\",children:(0,t.jsxDEV)(n.code,{children:\"BotCommands\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:54,columnNumber:22},this)},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:54,columnNumber:21},this),\" , every command starting with \",(0,t.jsxDEV)(n.code,{children:\"/\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:54,columnNumber:112},this)]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:54,columnNumber:1},this),`\n`]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:54,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.pre,{children:(0,t.jsxDEV)(n.code,{className:\"language-tsx\",children:`export class BotWithCommands extends DecoratorBot {\n  private setCommands(bot) {\n    bot.command(\"syncIMDB\", syncIMDB);\n    bot.start(start);\n    bot.help(help);\n  }\n\n  public launch() {\n    this.setCommands(this.bot);\n    super.launch();\n  }\n}\n`},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:56,columnNumber:1},this)},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:56,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.ul,{children:[`\n`,(0,t.jsxDEV)(n.li,{children:[\"One to handle \",(0,t.jsxDEV)(n.code,{children:\"BotEvents\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:71,columnNumber:17},this),\" or \",(0,t.jsxDEV)(n.a,{href:\"https://core.telegram.org/api/bots/inline\",children:\"inline queries\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:71,columnNumber:32},this),\".\"]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:71,columnNumber:1},this),`\n`]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:71,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.pre,{children:(0,t.jsxDEV)(n.code,{className:\"language-tsx\",children:`import { DecoratorBot } from \"../decorator\";\nimport { documentEvent } from \"./document\";\n\nexport class BotWithEvents extends DecoratorBot {\n  private setEvents(bot) {\n    bot.on(\"document\", documentEvent);\n    bot.on(\"sticker\", (ctx: any) => ctx.reply(\"\\u{1F44D}\"));\n  }\n\n  public launch() {\n    this.setEvents(this.bot);\n    super.launch();\n  }\n}\n`},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:73,columnNumber:1},this)},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:73,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:[\"You can \",(0,t.jsxDEV)(n.a,{href:\"https://github.com/zeyadetman/ben-personal-assistant\",children:\"read the code\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:90,columnNumber:9},this),\" to understand more about the implementation and the idea for these decorators.\"]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:90,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:\"The final structure was something like this\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:92,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.pre,{children:(0,t.jsxDEV)(n.code,{className:\"language-bash\",children:`.\n\\u251C\\u2500\\u2500 commands\n\\u2502\\xA0\\xA0 \\u251C\\u2500\\u2500 help.ts\n\\u2502\\xA0\\xA0 \\u251C\\u2500\\u2500 index.ts\n\\u2502\\xA0\\xA0 \\u251C\\u2500\\u2500 start.ts\n\\u2502\\xA0\\xA0 \\u251C\\u2500\\u2500 syncIMDB.ts\n\\u2502\\xA0\\xA0 \\u2514\\u2500\\u2500 syncNotion.ts\n\\u251C\\u2500\\u2500 decorator\n\\u2502\\xA0\\xA0 \\u2514\\u2500\\u2500 index.ts\n\\u251C\\u2500\\u2500 events\n\\u2502\\xA0\\xA0 \\u251C\\u2500\\u2500 document.ts\n\\u2502\\xA0\\xA0 \\u2514\\u2500\\u2500 index.ts\n\\u251C\\u2500\\u2500 index.ts\n\\u251C\\u2500\\u2500 types\n\\u2514\\u2500\\u2500 utils\n    \\u251C\\u2500\\u2500 constants.ts\n    \\u251C\\u2500\\u2500 convert-name.ts\n    \\u2514\\u2500\\u2500 writeFileToGithub.ts\n`},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:94,columnNumber:1},this)},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:94,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.h3,{children:[(0,t.jsxDEV)(n.code,{children:\"/syncIMDB\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:115,columnNumber:5},this),\" Create a list of my movies ratings\"]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:115,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:[\"This was the first thing i handled in the bot. The problem is I need to show a list of all my movies ratings, I use IMDB to track this, but IMDB doesn\\u2019t offer apis to get my ratings, So the solution that i use is exporting the ratings manually, and send this file to the bot telling him to update this file to \",(0,t.jsxDEV)(n.a,{href:\"https://github.com/zeyadetman/ben-personal-assistant/blob/7528d28b6b860c819eadf321d616c3986dd0e4c4/src/commands/syncIMDB.ts#L14\",children:\"re-format it\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:117,columnNumber:311},this),\" into \",(0,t.jsxDEV)(n.a,{href:\"https://github.com/zeyadetman/Notes/blob/main/src/data/imdb.json\",children:\"a json file\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:117,columnNumber:460},this),\", then add this file to the notes app, and GitHub action will redeploy the app updating the movies list on my notes app with these new ratings.\"]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:117,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:[\"I use \",(0,t.jsxDEV)(n.a,{href:\"https://nivo.rocks/\",children:\"nivo.rocks\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:119,columnNumber:7},this),\" to visualize the genres and make the list more interactive. Please \",(0,t.jsxDEV)(n.a,{href:\"https://github.com/plouc/nivo/issues/920#issuecomment-1256857723\",children:\"read my comment\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:119,columnNumber:108},this),\" on how I implemented it.\"]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:119,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:[\"This was a little bit tricky especially because I\\u2019m using \",(0,t.jsxDEV)(n.a,{href:\"https://docusaurus.io/\",children:\"docusaurus.io\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:121,columnNumber:59},this),\" but you can check the code for it \",(0,t.jsxDEV)(n.a,{href:\"https://github.com/zeyadetman/Notes/edit/main/docs/watch-list/movies.mdx\",children:\"from here\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:121,columnNumber:133},this),\".\"]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:121,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:\"I use the same json file to add more pages with the same style.\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:123,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.ul,{children:[`\n`,(0,t.jsxDEV)(n.li,{children:(0,t.jsxDEV)(n.a,{href:\"https://notes.zeyadetman.com/watch-list/\",children:\"https://notes.zeyadetman.com/watch-list/\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:125,columnNumber:3},this)},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:125,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.li,{children:(0,t.jsxDEV)(n.a,{href:\"https://notes.zeyadetman.com/games/\",children:\"https://notes.zeyadetman.com/games/\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:126,columnNumber:3},this)},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:126,columnNumber:1},this),`\n`]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:125,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.h2,{children:[(0,t.jsxDEV)(n.code,{children:\"/syncNotion\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:128,columnNumber:4},this),\" Notion integration\"]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:128,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:[\"The second thing is getting pages from notion. So the idea is creating a \",(0,t.jsxDEV)(n.a,{href:\"https://www.notion.so/help/intro-to-databases\",children:\"database on notion\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:130,columnNumber:74},this),\" that contains multiple nested pages with their slugs/paths and this command will get the database by its id and fetching all pages under this databases including nested databases, then create commits with the files on \",(0,t.jsxDEV)(n.a,{href:\"https://github.com/zeyadetman/Notes/\",children:\"Notes Repo on GitHub\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:130,columnNumber:360},this),\". That\\u2019s the idea I\\u2019ve came with.\"]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:130,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:\"Here\\u2019s the code for it.\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:132,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.pre,{children:(0,t.jsxDEV)(n.code,{className:\"language-tsx\",children:`const handleDatabases = async (\n  databaseId: string,\n  pagesToPublish: any,\n  parentSlug = \"\"\n) => {\n  return new Promise(async (resolve, reject) => {\n    try {\n      const { results } = await notion.databases.query({\n        database_id: databaseId,\n      });\n      const pages = results.filter((res) => res.object === \"page\");\n      pages.forEach(async (page: any) => {\n        if (page?.properties?.Slug?.rich_text?.[0]?.plain_text) {\n          pagesToPublish[page.properties.Slug.rich_text[0].plain_text] = {\n            slug: page.properties.Slug.rich_text[0].plain_text,\n            isPublish: page.properties?.Published?.checkbox || false,\n            path: \\`\\${parentSlug || \"\"}\\${\n              page.properties.Slug.rich_text[0].plain_text\n            }\\`,\n            page,\n          };\n        } else {\n          return ctx.reply(\"Please add a slug to the page\");\n        }\n      });\n\n      for await (let page of Object.values(pagesToPublish)) {\n        const { slug, page: pageInfo } = page as any;\n        const mdblocks = await n2m.pageToMarkdown(pageInfo.id);\n        const finalMdBlocks = [];\n        mdblocks?.forEach(async (block: any, index) => {\n          if (index === mdblocks?.length - 1) {\n            return;\n          }\n          if (block.type === \"child_database\") {\n            const databaseId = block.parent.split(\"(\").pop().split(\")\")[0];\n            pagesToPublish[slug].children = {\n              databaseId,\n              slug,\n              parentSlug: \\`\\${parentSlug || \"\"}\\${slug}\\`,\n            };\n          } else {\n            finalMdBlocks.push(block);\n          }\n        });\n\n        pagesToPublish[slug].mdBlocks = finalMdBlocks;\n      }\n\n      for await (let page of Object.keys(pagesToPublish)) {\n        const { children, slug } = pagesToPublish[page] as any;\n        if (children?.databaseId) {\n          pagesToPublish[slug].childs = await handleDatabases(\n            children.databaseId,\n            {},\n            \\`\\${children.parentSlug}\\`\n          );\n        }\n      }\n\n      console.log(util.inspect(pagesToPublish, false, null, true));\n      return resolve(pagesToPublish);\n    } catch (error) {\n      return reject(error.message);\n    }\n  });\n};\n`},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:134,columnNumber:1},this)},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:134,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:[`And that\\u2019s works great with a sample of notion database like this:\n`,(0,t.jsxDEV)(n.img,{src:\"/assets/telegram-bot-img1.PNG\",alt:\"\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:205,columnNumber:1},this)]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:204,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:[\"So if the page\\u2019s \",(0,t.jsxDEV)(n.code,{children:\"Published\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:207,columnNumber:18},this),\" property is false, then the page will not be published to github repo, and if the page doesn\\u2019t have a \",(0,t.jsxDEV)(n.code,{children:\"Slug\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:207,columnNumber:132},this),\" property it should gives an error, because the slug is a path of that file.\"]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:207,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:[`The final command on telegram gave me this reply\n`,(0,t.jsxDEV)(n.img,{src:\"/assets/telegram-bot-img2.PNG\",alt:\"\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:210,columnNumber:1},this)]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:209,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:\"Wow! that\\u2019s totally awesome \\u{1F60E}\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:212,columnNumber:1},this),`\n`,(0,t.jsxDEV)(\"br\",{},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:214,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:`Until then I\\u2019ll let this post ends in this point and will update it whenever I add\nnew feature.`},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:215,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:\"\\u2026to be continued\"},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:218,columnNumber:1},this),`\n`,(0,t.jsxDEV)(\"br\",{},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:220,columnNumber:1},this),`\n`,(0,t.jsxDEV)(\"br\",{},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:221,columnNumber:1},this),`\n`,(0,t.jsxDEV)(n.p,{children:(0,t.jsxDEV)(n.em,{children:[\"Updated at \",new Date(\"2021-09-28\").toDateString()]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:223,columnNumber:1},this)},void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:223,columnNumber:1},this)]},void 0,!0,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\",lineNumber:1,columnNumber:1},this)}function gn(c={}){let{wrapper:n}=c.components||{};return n?(0,t.jsxDEV)(n,Object.assign({},c,{children:(0,t.jsxDEV)(ze,c,void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\"},this)}),void 0,!1,{fileName:\"/Users/zeyadetman/Side Projects/blog-v5/content/posts/_mdx_bundler_entry_point-019ac82b-ec0a-4dd9-97dd-90df898780fa.mdx\"},this):ze(c)}var yn=gn;return pn(vn);})();\n/*! Bundled license information:\n\nreact/cjs/react-jsx-dev-runtime.development.js:\n  (**\n   * @license React\n   * react-jsx-dev-runtime.development.js\n   *\n   * Copyright (c) Facebook, Inc. and its affiliates.\n   *\n   * This source code is licensed under the MIT license found in the\n   * LICENSE file in the root directory of this source tree.\n   *)\n*/\n;return Component;"
  },
  "_id": "posts/building-personal-assistant-bot-with-telegram.mdx",
  "_raw": {
    "sourceFilePath": "posts/building-personal-assistant-bot-with-telegram.mdx",
    "sourceFileName": "building-personal-assistant-bot-with-telegram.mdx",
    "sourceFileDir": "posts",
    "contentType": "mdx",
    "flattenedPath": "posts/building-personal-assistant-bot-with-telegram"
  },
  "type": "Post",
  "slug": "/posts/building-personal-assistant-bot-with-telegram",
  "slugAsParams": "building-personal-assistant-bot-with-telegram"
}